# 数据集大小估算

## 验证集/测试集样本数量

根据实际加载的数据集大小：

| 数据集 | Split | 样本数 | 说明 |
|--------|-------|--------|------|
| **TextVQA** | validation | **5,000** | 标准验证集 |
| **OK-VQA** | validation | **5,046** | 标准验证集 |
| **ScienceQA** | validation | **2,097** | 较小的验证集 |
| **ST-VQA** | validation | **1,024** | 从训练集中随机选择的前1024个样本 |
| **DocVQA** | validation | **5,349** | 标准验证集 |
| **TallyQA** | test | **26,451** | 使用测试集（没有验证集） |
| **总计** | - | **44,967** | - |

## 实验时间估算

### Exp5 (Accuracy) - 运行整个数据集

使用 `balanced` 采样策略，约 **27 个组合**：

- **总样本数**: 44,967 个样本
- **总推理次数**: 27 组合 × 44,967 样本 ≈ **1,214,109 次推理**
- **批次估算**: 
  - 假设 batch_size=64, 4 GPUs
  - 每个组合约需要: 44,967 ÷ (64 × 4) ≈ **176 个批次**
  - 27 个组合总计: 27 × 176 ≈ **4,752 个批次**

**预计时间**:
- 每个数据集: **2-6 小时**（取决于数据集大小和实际 batch size）
- 所有数据集总计: **12-36 小时**（6 个数据集）

### Exp6 (Latency) - 运行 5,000 个样本

使用 `balanced` 采样策略，约 **27 个组合**：

- **每个数据集样本数**: 5,000 个样本（固定）
- **总推理次数**: 27 组合 × 5,000 样本 × 6 数据集 ≈ **810,000 次推理**
- **批次估算**:
  - batch_size=1, 4 GPUs
  - 每个组合约需要: 5,000 ÷ 4 ≈ **1,250 个批次**
  - 27 个组合总计: 27 × 1,250 ≈ **33,750 个批次/数据集**

**预计时间**:
- 每个数据集: **1-3 小时**
- 所有数据集总计: **6-18 小时**（6 个数据集）

## 存储空间估算

### Exp5 结果文件大小

每个样本保存的字段：
- `sample_id`, `score`, `pred`, `answer_idx`, `predicted_idx`, `options` (或 `answers`)
- 每个样本约 **200-500 bytes**（JSON 格式）

**估算**:
- 每个数据集: 44,967 样本 × 27 组合 × 400 bytes ≈ **485 MB**
- 所有数据集: 485 MB × 6 ≈ **2.9 GB**

### Exp6 结果文件大小

每个样本保存的字段：
- `sample_id`, `max_crops`, `top_k`, `num_active_blocks`
- `T_total_ms`, `T_prefill_ms`, `T_decode_ms`
- `num_vision_tokens`, `num_language_tokens`, `num_output_tokens`, `num_total_tokens`
- `accuracy`, `score` (或相关字段)
- 每个样本约 **300-600 bytes**（JSON 格式）

**估算**:
- 每个数据集: 5,000 样本 × 27 组合 × 500 bytes ≈ **68 MB**
- 所有数据集: 68 MB × 6 ≈ **408 MB**

**总计存储空间**: 约 **3.3 GB**

## 注意事项

1. **Exp5 运行时间较长**：因为需要运行整个数据集，建议：
   - 使用 screen/tmux 运行，避免网络中断
   - 考虑分批运行数据集（先运行小数据集）
   - 监控 GPU 使用情况

2. **Exp6 相对较快**：每个数据集只运行 5,000 个样本，适合快速迭代

3. **存储空间**：结果文件约 3.3 GB，确保有足够空间

4. **组合数量**：`balanced` 策略的实际组合数可能略有不同，取决于实现细节

5. **批次大小**：Exp5 使用自动调整的 batch size，实际批次数可能有所不同

