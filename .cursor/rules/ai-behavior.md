# AI Agent 行为规范

## 代码生成原则

1. **理解现有代码结构**
   - 生成代码前必须阅读相关文件，理解项目架构
   - 优先使用项目中已有的工具函数、类和模块
   - 不要重复实现已有功能

2. **遵循项目约定**
   - 严格遵循项目的编码标准和命名约定
   - 保持代码风格与现有代码一致
   - 遵循项目的文件组织结构

3. **代码质量**
   - 生成的代码应该清晰、可读、可维护
   - 包含必要的类型注解和文档字符串
   - 处理边界情况和错误情况

## 代码修改策略

1. **修改前分析**
   - 修改代码前先完整阅读相关文件
   - 理解代码的上下文和依赖关系
   - 检查是否有其他代码依赖被修改的部分

2. **保持一致性**
   - 修改代码时保持与现有代码风格一致
   - 使用项目中已有的模式和约定
   - 不要引入新的代码风格

3. **影响范围检查**
   - 修改函数时检查所有调用点
   - 修改类时检查所有使用该类的代码
   - 重大修改前先搜索相关代码

## 错误处理

1. **有意义的错误消息**
   - 错误消息应该清晰描述问题
   - 包含足够的上下文信息（如参数值、状态等）
   - 提供可能的解决方案或建议

2. **错误记录**
   - 记录错误发生的上下文
   - 使用适当的日志级别
   - 不要吞掉异常，除非有明确的理由

3. **回退方案**
   - 对于可能失败的操作，提供回退方案
   - 考虑网络请求、文件操作等可能失败的情况

## 文档和代码同步更新（重要）

**核心原则**：文档和代码必须同步更新，这是开发流程的重要组成部分。

### 1. 开发新功能时的文档工作流

1. **开发前：查阅现有文档**
   - 在开发新功能前，必须先查阅 `docs/` 目录下的相关文档
   - 理解现有的设计模式、约定和最佳实践
   - 参考现有文档的结构和风格
   - 确保新功能与现有架构和约定一致

2. **开发中：同步更新文档**
   - 在编写代码的同时，同步更新或创建相关文档
   - 不要等到代码完成后再更新文档
   - 文档应该反映代码的当前状态，而不是"计划中的状态"

3. **开发后：验证文档准确性**
   - 确保文档中的示例代码可以运行
   - 验证文档中的路径、参数、配置都是正确的
   - 检查文档是否完整描述了新功能

### 2. 文档更新的具体要求

1. **新功能文档**
   - 如果添加新功能，必须创建或更新相关文档
   - 文档位置：`docs/` 目录下相应的子目录
   - **文档命名**：必须使用小写字母和下划线（`snake_case`）
     - ✅ 正确：`new_feature_guide.md`, `api_reference.md`
     - ❌ 错误：`NewFeatureGuide.md`, `NEW_FEATURE_GUIDE.md`, `new-feature-guide.md`
   - 文档应该包括：
     - 功能概述
     - 使用方法
     - 配置选项
     - 示例代码
     - 注意事项

2. **API 变更文档**
   - 如果修改了 API，必须更新 API 文档
   - 说明变更的原因和影响
   - 提供迁移指南（如果适用）

3. **实验脚本文档**
   - 如果添加新的实验脚本，必须更新实验文档
   - 说明实验的目的、方法、参数
   - 提供运行示例

4. **配置文件文档**
   - 如果添加新的配置选项，必须更新配置文档
   - 说明每个选项的含义和默认值

### 3. 文档查找和参考

在开发新功能时，AI Agent 必须：

1. **搜索相关文档**
   ```python
   # 在开发前，搜索相关文档
   # 例如：如果要开发评估功能，搜索 docs/evaluation/
   # 如果要开发控制器功能，搜索 docs/controller/
   ```

2. **参考现有文档结构**
   - 查看类似功能的文档，了解文档结构
   - 保持文档风格一致
   - 使用相同的格式和约定

3. **更新文档索引**
   - 如果创建了新文档，更新相关的索引或 README
   - 确保文档可以被找到

### 4. 文档和代码的一致性检查

在提交代码前，检查：

- [ ] 新功能是否有对应的文档？
- [ ] 文档中的示例代码是否可以运行？
- [ ] 文档中的路径是否正确（遵循文件组织规范）？
- [ ] 文档中的参数和配置是否与代码一致？
- [ ] 文档是否完整描述了功能的使用方法？

## 文档和注释

1. **文档更新**
   - 新功能必须更新相关文档（README、API 文档等）
   - 修改现有功能时检查是否需要更新文档
   - 文档应该清晰、准确、完整
   - **重要**：文档和代码必须同步更新，不要分离进行

2. **代码注释**
   - 复杂逻辑必须添加注释
   - 注释应该解释"为什么"而不是"是什么"
   - 避免显而易见的注释

3. **示例代码**
   - 提供使用示例，特别是对于新功能
   - 示例应该完整、可运行

## 测试要求

1. **测试覆盖**
   - 新功能应该包含测试
   - 修改现有功能时更新相关测试
   - 测试应该覆盖正常情况和边界情况

2. **测试质量**
   - 测试应该独立、可重复
   - 测试名称应该清晰描述测试内容
   - 使用有意义的断言消息

## 性能考虑

1. **效率**
   - 考虑代码的性能影响
   - 避免不必要的计算或 I/O 操作
   - 对于大型数据集，考虑批处理和流式处理

2. **资源使用**
   - 注意内存和 GPU 使用
   - 及时释放不需要的资源
   - 对于大模型，考虑使用 `device_map` 和 `torch_dtype`

## 安全性

1. **输入验证**
   - 验证用户输入和外部数据
   - 防止路径遍历、注入等安全问题

2. **敏感信息**
   - 不要硬编码 API 密钥、密码等敏感信息
   - 使用环境变量或配置文件（不提交到 Git）

## 代码审查建议

当生成或修改代码时，AI Agent 应该：

1. 检查代码是否符合所有规则
2. 确保没有引入明显的 bug
3. 确保代码可以正常运行
4. 提供清晰的提交信息（如果适用）

