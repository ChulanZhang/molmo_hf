# EXP3 低相关性数据集分析

## 概述

本文档分析为什么 `doc_qa`、`coco_2014_vqa` 和 `mmmu` 三个数据集在训练集和验证集上的重要性分数相关性较低。

## 数据集基本信息

| 数据集 | 样本数 | 任务类型 | 答案长度 | 相关性 | P值 |
|--------|--------|----------|----------|--------|-----|
| **doc_qa** | 5,349 | Document VQA | 平均 4.6 tokens | 0.8853 | 5.15e-06 |
| **coco_2014_vqa** | 214,354 | Visual Q&A | 平均 1.4 tokens | 0.8374 | 5.19e-05 |
| **mmmu** | 900 | Multi-modal Understanding | 平均 1.1 tokens | 0.2558 | 3.39e-01 |

---

## 1. MMMU (相关性: 0.2558) - 严重不一致

### 关键发现

1. **样本量过小** (900 样本)
   - 训练集中有 3 个 block 的重要性分数为 0
   - 验证集中有 1 个 block 的重要性分数为 0
   - 统计显著性不足，导致估计不稳定

2. **Split 差异**
   - 训练集使用 "dev" split
   - 验证集使用 "validation" split
   - 可能存在分布偏移（distribution shift）

3. **Block 0 重要性差异巨大**
   - 训练集: 0.2105
   - 验证集: 0.0533
   - 差异: 0.1572 (74.67% 相对差异)

4. **负重要性分数**
   - 验证集中 block 4, 7, 12 的分数为负
   - 表明移除这些 block 反而提高准确率
   - 可能原因：过拟合或数据集特定效应

5. **排名重叠极低**
   - Top 5 最不重要 block 的重叠：仅 1/5
   - 训练集和验证集对哪些 block 不重要存在严重分歧

### 根本原因

**主要因素：样本量过小 + Split 分布差异**

- 900 个样本不足以可靠估计 16 个 block 的重要性
- dev 和 validation split 可能来自不同的数据分布
- 统计噪声掩盖了真实的块重要性模式

### 建议

1. **增加样本量**：使用全部可用样本（dev + validation）
2. **验证 split 分布**：检查 dev 和 validation 的数据分布是否相似
3. **谨慎使用**：对于如此小的数据集，重要性分析可能不可靠

---

## 2. COCO 2014 VQA (相关性: 0.8374) - 中等不一致

### 关键发现

1. **样本量充足** (214,354 样本)
   - 样本量不是问题
   - 统计显著性应该足够

2. **任务简单**
   - 答案极短（平均 1.4 tokens）
   - 主要是单词语答案（如 "red", "two", "yes"）
   - 任务可能过于简单，导致块重要性差异不明显

3. **Block 0 差异较小**
   - 训练集: 0.6153
   - 验证集: 0.5880
   - 差异: 0.0273 (4.43% 相对差异) - 可接受

4. **排名重叠中等**
   - Top 5 最不重要 block 的重叠：3/5
   - 趋势相似，但细节有差异

5. **中间层重要性差异**
   - Block 11, 1, 10, 12 在训练集和验证集上的重要性有差异
   - 相对差异较大（17-27%），但绝对值较小

### 根本原因

**主要因素：任务特性 + 可能的过拟合**

- 任务过于简单，导致块重要性差异不明显
- 虽然样本量大，但任务简单可能使模型对训练数据过拟合
- 相关性 0.8374 虽然低于 0.9，但仍在可接受范围内

### 建议

1. **可接受的相关性**：0.8374 虽然未达到 0.9 阈值，但趋势相似
2. **使用训练集分析**：对于如此大的数据集，训练集的结果应该可靠
3. **考虑任务特性**：简单任务可能导致块重要性模式不明显

---

## 3. DOC_QA (相关性: 0.8853) - 轻微不一致

### 关键发现

1. **样本量中等** (5,349 样本)
   - 应该足够进行统计分析
   - 但可能仍有一些方差

2. **任务复杂**
   - 文档图像（扫描文档、表格、表单等）
   - 答案较长（平均 4.6 tokens，最大 28 tokens）
   - 需要理解文档结构和文本内容

3. **Block 0 差异较大**
   - 训练集: 0.7886
   - 验证集: 0.6703
   - 差异: 0.1183 (15.00% 相对差异) - 主要问题

4. **不同 block 的重要性模式**
   - 训练集中 block 6, 7 的重要性: 0.072, 0.072
   - 验证集中 block 6, 7 的重要性: 0.079, 0.084
   - 验证集中这些 block 更重要

5. **排名重叠高**
   - Top 5 最不重要 block 的重叠：4/5
   - 整体趋势一致

### 根本原因

**主要因素：训练/验证集分布差异**

- 文档类型可能不同（训练集和验证集可能包含不同类型的文档）
- 文档复杂度可能不同
- Block 0 的重要性差异（15%）表明训练集和验证集在基础特征提取上有差异

### 建议

1. **检查数据分布**：验证训练集和验证集的文档类型分布是否相似
2. **使用训练集**：虽然相关性略低于 0.9，但 0.8853 仍然较高，可以使用训练集进行分析
3. **考虑文档类型**：如果文档类型差异大，可能需要分别分析

---

## 综合分析与结论

### 影响因素总结

| 因素 | MMMU | COCO 2014 VQA | DOC_QA | 影响程度 |
|------|------|---------------|--------|----------|
| **样本量** | ❌ 过小 (900) | ✅ 充足 (214K) | ⚠️ 中等 (5K) | 高 |
| **Split 分布** | ❌ 不同 (dev vs val) | ✅ 相同 | ✅ 相同 | 高 |
| **任务复杂度** | ⚠️ 中等 | ❌ 简单 | ✅ 复杂 | 中 |
| **Block 0 差异** | ❌ 巨大 (0.16) | ✅ 小 (0.03) | ⚠️ 大 (0.12) | 高 |
| **负分数** | ❌ 有 | ✅ 无 | ✅ 无 | 中 |
| **排名重叠** | ❌ 低 (1/5) | ⚠️ 中 (3/5) | ✅ 高 (4/5) | 中 |

### 根本原因分类

1. **统计因素**（MMMU）
   - 样本量过小导致估计不稳定
   - 统计噪声掩盖真实模式

2. **分布因素**（MMMU, DOC_QA）
   - 训练集和验证集的数据分布不同
   - Split 差异（MMMU 使用 dev vs validation）
   - 文档类型差异（DOC_QA）

3. **任务因素**（COCO 2014 VQA）
   - 任务过于简单，块重要性差异不明显
   - 可能导致过拟合

4. **模型因素**（MMMU）
   - 负重要性分数表明移除某些 block 反而提高准确率
   - 可能表明过拟合或数据集特定效应

### 通用建议

1. **样本量要求**
   - 对于重要性分析，建议至少 2,000-5,000 样本
   - 小数据集（< 2K）应使用全部样本

2. **Split 一致性**
   - 确保训练集和验证集来自相同的数据分布
   - 对于使用不同 split 名称的数据集（如 MMMU），需要验证分布相似性

3. **任务特性**
   - 简单任务可能导致块重要性模式不明显
   - 复杂任务（如文档理解）可能对块重要性更敏感

4. **相关性阈值**
   - 相关性 > 0.9：高度一致，可以放心使用训练集
   - 相关性 0.8-0.9：可接受，但需要注意差异
   - 相关性 < 0.8：需要进一步调查原因

5. **使用建议**
   - **MMMU**: 不建议使用，样本量过小且相关性极低
   - **COCO 2014 VQA**: 可以使用训练集，相关性虽然略低但可接受
   - **DOC_QA**: 可以使用训练集，但需要注意 Block 0 的差异

---

## 参考文献

- 数据集样本数量：`docs/core_exp/dataset_sample_counts.md`
- 答案长度分析：`experiments/core_exp/answer_length_summary.md`
- 实验结果：`results/profiling/exp3_importance_comparison/`


